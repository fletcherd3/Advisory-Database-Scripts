import dependent


class Vulnerability:
    def __init__(self, data):
        self.id = data['id']
        self.package = data['affected'][0]['package']['name']
        self.package_manager = dependent.PACKAGE_MANAGER[data['affected'][0]['package']['ecosystem']]
        self.affected_versions = []  # self.set_affected_versions(data)
        self.patched_versions = []  # self.set_patched_versions(data)
        self.dependents = dependent.set_dependents(self.package, self.package_manager)

    def generate_dependents_str(self):
        dependent_str = "---------------------------------------------------\n"
        for depend in self.dependents:
            dependent_str = dependent_str + str(depend) + "\n"
        dependent_str += "---------------------------------------------------\n"
        return dependent_str

    def __str__(self):
        dependents_str = self.generate_dependents_str()
        return "===================================================\n" \
               "Vulnerability {0}:\n" \
               "Package: {1}\n" \
               "Package Manager: {2}\n" \
               "Affected Versions: {3}\n" \
               "Patched Versions: {4}\n" \
               "Dependents: \n" \
               "{5} \n" \
               "===================================================\n".format(self.id, self.package,
                                                                              self.package_manager,
                                                                              self.affected_versions,
                                                                              self.patched_versions, dependents_str)
